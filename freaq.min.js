/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**(c) 2014 Zach Pomerantz; github.com/zzmp/pown
 * # POWN eventing system
 * ### A 100 SLOC mangling of the JavaScript eventing system
 *
 * `pown` your objects using `obj.prototype = Object.create(pown);`
 * That's right - don't even worry about your constructor - that's
 * some pseudo-classical garbage. You *powned* it.
 */

(function(){var e,t,n;(function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("node_modules/almond/almond",function(){}),function(e,t){typeof n=="function"&&n.amd?n("node_modules/pown/pown",t):typeof exports=="object"?module.exports=t():e.pown=t()}(this,function(){var e={};return e.on=function(e,t,n){var r={callback:t,context:n||this},i=this._events||(this._events={});return(i[e]||(i[e]=[])).push(r),this},e.off=function(e,t,n){if(!this._events||!this._events[e])return this;var r=this._events[e],i=this._events[e]=[];switch(arguments.length){case 3:case 2:var s={callback:t,context:n||this};for(var o=0;o<r.length;o++)(r[o].callback!==s.callback||n!==undefined&&n!==s.context)&&i.push(r[o]);case 1:break;case 0:this._events={}}return this},e.trigger=function(e){if(!this._events||!this._events[e])return this;var t=this._events[e],n=t.length,r=Array.prototype.slice.call(arguments,1);for(var i=0;i<n;i++){var s=t[i];s.callback.apply(s.context,[this].concat(r))}return this},e.set=function(e,t){var n=this.props||(this.props={}),r=n[e];return r===t?t:(n[e]=t,this.trigger("change",{p:e,o:r,w:undefined,n:t}),t)},e.get=function(e){var t=this.props||(this.props={});return t[e]},e}),n("shim",[],function(){return{AudioContext:window.AudioContext||window.webkitAudioContext,requestAnimationFrame:function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return t?t.call(window,e):function(e){window.setTimeout(e,1e3/24)}},requestFullscreen:function(){var e=this.requestFullscreen||this.webkitRequestFullScreen||this.mozRequestFullScreen||this.msRequestFullScreen;e.call(this)},exitFullscreen:function(){var e=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullScreen;e.call(document)},fullscreenElement:function(){return document.FullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullScreenElement},onfullscreenchange:function(e,t){document.addEventListener("fullscreenchange",e,t),document.addEventListener("webkitfullscreenchange",e,t),document.addEventListener("mozfullscreenchange",e,t),document.addEventListener("msfullscreenchange",e,t)}}}),n("Model/Context",["../node_modules/pown/pown","../shim"],function(e,t){var n=function(e){this.mediaElement=e;var n=new t.AudioContext,r=this.set("source",n.createMediaElementSource(e)),i=this.set("analyser",n.createAnalyser()),s=this.set("loFilter",n.createBiquadFilter()),o=this.set("hiFilter",n.createBiquadFilter()),u=this.set("destination",n.destination);s.type="lowshelf",o.type="highshelf";var a=s.frequency.minValue,f=s.gain.minValue,l=s.frequency.maxValue-a,c=s.gain.maxValue-f;this.on("change",function(e,t){var n;switch(t.p){case"smooth":i.smoothingTimeConstant=t.n;break;case"fft":i.fftSize=t.n;break;case"loFreq":n=s;case"hiFreq":n=o,n.frequency.value=a+l*t.n;break;case"loGain":n=s;case"hiGain":n=o,n.gain.value=f+c*t.n}}),this.set("loFreq",.5),this.set("hiFreq",.5),this.set("loGain",.5),this.set("hiGain",.5),r.connect(i),i.connect(s),s.connect(o),o.connect(u);var h=this.trigger.bind(this,"loadstart"),p=this.trigger.bind(this,"play"),d=this.trigger.bind(this,"pause");e.addEventListener("loadstart",h),e.addEventListener("play",p),e.addEventListener("pause",d)};return n.prototype=Object.create(e),n.prototype.play=function(){this.mediaElement.play()},n}),n("Model/UX",["../node_modules/pown/pown"],function(e){var t=function(e){this.on("change",function(t,n){var r=n.p,i=n.n;switch(r){case"hue":if(i<0||i>256)return;i=Math.floor(i)%256;break;case"rainbow":if(i!==-1&&i!==0&&i!==1)return;case"fullscreen":break;default:switch(r){case"smooth":if(i<0||i>1)return;break;case"fft":if(i<32||i>2048)return;if(i&i-1)return;break;case"loFreq":case"hiFreq":case"loGain":case"hiGain":if(i<0||i>1)return;default:return}e.set(r,i);return}this.set(r,i)}),this.set("hue",215),this.set("rainbow",0)};return t.prototype=Object.create(e),t}),n("View/Visualizer",["../shim"],function(e){var t=function(e,t){this.analyser=e.get("analyser"),this.ux=t,this.el=document.createElement("canvas"),this.el.style.cssText="left: 0; top: 0; width: 100%; height: 100%;",this.isPaused=!1,e.on("play",n.bind(this)),e.on("pause",r.bind(this))};t.prototype.boot=function(){i.call(this)};var n=function(){var e=this.isPaused;this.isPaused=!1,e&&i.call(this)},r=function(){this.isPaused=!0},i=function(){var t=this.el,n=t.getContext("2d"),r=t.clientWidth,s=t.clientHeight,o=this.analyser,u=o.frequencyBinCount,a=new Uint8Array(u);o.getByteFrequencyData(a);var f=this.ux.get("hue"),l=this.ux.get("rainbow");l===1&&this.ux.set("hue",f+1);for(var c=0;c<u;c++){var h=a[c],p=r/u,d=h/256,v=s*d,m=s-v-1;l===-1&&(f=this.ux.set("hue",f+1)),n.fillStyle="hsl("+f+", 100%, 50%)",n.clearRect(c*p,0,p,s),n.fillRect(c*p,m,p,2)}this.isPaused||e.requestAnimationFrame(i.bind(this))};return t}),n("View/Min",[],function(){var e=function(e){var t=this.toolbar=document.createElement("div"),n=document.createElement("div");t.style.setProperty("height","27px"),n.style.cssText="margin: 3px; border: 3px solid #E8E8E8; border-radius: 75% / 25%; float: left; width: 21px; height: 18px;",n.addEventListener("mouseenter",function(){n.style.setProperty("border","3px solid #585858")}),n.addEventListener("mouseleave",function(){n.style.setProperty("border","3px solid #C8C8C8")}),n.addEventListener("click",function(){e.set("fullscreen",!0)}),t.appendChild(n)};return e.prototype.attach=function(e){var t=document.getElementById("watch7-sidebar-ads");while(t.children.length)t.removeChild(t.firstElementChild);t.appendChild(e),t.appendChild(this.toolbar)},e.prototype.detach=function(e){var t=document.getElementById("watch7-sidebar-ads");while(t.children.length)t.removeChild(t.firstElementChild)},e}),n("View/Toolbar",[],function(){var e=function(){};return e}),n("View/Max",["./Toolbar","../shim"],function(e,t){var n=function(t){var n=this.el=document.createElement("div"),r=(new e).el;this.video=document.querySelector("video"),n.style.cssText="background-color: black; width: 100%; height: 100%",n.addEventListener("mousemove",function(){})};return n.prototype.attach=function(e){this.video&&(this.parent=this.video.parentElement,this.el.appendChild(this.video),this.video.style.setProperty("display","none")),this.el.appendChild(e),document.querySelector("body").appendChild(this.el),t.requestFullscreen.call(this.el)},n.prototype.detach=function(e){this.video&&this.parent&&(this.parent.appendChild(this.video),this.video.style.setProperty("display","block")),this.el.removeChild(e),t.exitFullscreen()},n}),n("View/Mirror",["./Visualizer","./Min","./Max","../shim"],function(e,t,n,r){var i=function(i,u){this.context=i;var a=this.visualizer=new e(i,u),f=this.max=new n(u),l=this.min=new t(u);l.attach(a.el),a.boot(),i.on("loadstart",function(){window.setTimeout(function(){u.get("fullscreen")?f.attach(a.el):l.attach(a.el)},1e3/24)});var c=s.bind(this),h=o.bind(this);u.on("change",function(e,t){t.p==="fullscreen"&&(t.n?c():h())}),r.onfullscreenchange(function(){r.fullscreenElement()||u.set("fullscreen",!1)})},s=function(){var e=this.visualizer,t=e.isPaused,n=e.el;this.min.detach(n),this.max.attach(n),t||this.context.play()},o=function(){var e=this.visualizer,t=e.isPaused,n=e.el;this.max.detach(n),this.min.attach(n),t||this.context.play()};return i}),n("boot",["Model/Context","Model/UX","View/Mirror"],function(e,t,n){console.log("freaq out!");var r=new e(document.querySelector("video")),i=new t(r),s=new n(r,i);s.context=r,s.ux=i,window.freaq=s,s.checkMeOut=function(){console.log("Hungry for more?"),console.log("Check out the source at github.com/zzmp/freaq")}}),t(["boot"])})();